# CSRF和XSS攻击

## csrf与xss攻击的详解与区别

CSRF：跨站请求伪造

用户是网站A的注册用户，且登录进去，于是网站A就给用户下发cookie。

假设某银行网站A以GET请求来发起转账操作，转账的地址`www.xxx.com/transfer.doaccountNum=l000l&money=10000`，参数accountNum表示转账的账户，参数money表示转账金额。而某大型论坛B上，一个恶意用户上传了一张图片，而图片的地址栏中填的并不是图片的地址，而是前而所说的砖账地址：`<img src="http://www.xxx.com/transfer.do?accountNum=l000l&money=10000">`当你登录网站A后，没有及时登出，这时你访问了论坛B，不幸的事情发生了，你会发现你的账号里面少了10000块...为什么会这样呢，在你登录银行A时，你的浏览器端会生成银行A的cookie，而当你访问论坛B的时候，页面上的<img>标签需要浏览器发起一个新的HTTP请求，以获得图片资源，当浏览器发起请求时，请求的却是银行A的转账地址`www.xxx.com/transfer.do?accountNum=l000l&money=10000`，并且会带上银行A的cookie信息，结果银行的服务器收到这个请求后，会以为是你发起的一次转账操作，因此你的账号里边便少了10000块。



4.CSRF如何防御?---cookie设置httpOnly + token验证 + 隐藏令牌 + Referer验证

（1）方法1、将cookie设置为HttpOnly

（2）token的值通过服务端生成，表单提交后token的值通过POST请求与参数一同带到服务端，每次会话可以使用相同的token，会话过期，则token失效，攻击者因无法获取到token，也就无法伪造请求。

（3）方法3、隐藏令牌：把token隐藏在http的head头中。方法二和方法一有点像，本质上没有太大区别，只是使用方式上有区别。

（4）方法4、Referer验证：Referer指的是页面请求来源。意思是，只接受本站的请求，服务器才做响应；如果不是，就拦截。





## 二、xss攻击

1、XSS的基本概念：XSS（Cross Site Scripting）：跨域脚本攻击。

2、XSS攻击原理：不需要你做任何的登录认证，它会通过合法的操作（比如在url中输入、在评论框中输入），向你的页面注入脚本（可能是js、hmtl代码块等）。

3、XSS攻击后果：盗用Cookie破坏页面的正常结构，插入广告等恶意内容D-doss攻击

4、XSS的攻击方式，具体详见：[反射型XSS漏洞的条件+类型+危害+解决](https://blog.csdn.net/wuhuagu_wuhuaguo/article/details/79774187)
a. 反射型：发出请求时，XSS代码出现在url中，作为输入提交到服务器端，服务器端解析后响应，XSS代码随响应内容一起传回给浏览器，最后浏览器解析执行XSS代码。这个过程像一次反射，所以叫反射型XSS。
b.存储型：存储型XSS和反射型XSS的差别在于，提交的代码会存储在服务器端（数据库、内存、文件系统等），下次请求时目标页面时不用再提交XSS代码。





5、XSS的防范措施（encode+过滤）
XSS的防范措施主要有三个：编码、过滤、校正

1、编码：对用户输入的数据进行HTML Entity 编码。把字符转换成 转义字符。Encode的作用是将$var等一些字符进行转化，使得浏览器在最终输出结果上是一样的。
比如说这段代码：<script>alert(1)</script>
若不进行任何处理，则浏览器会执行alert的js操作，实现XSS注入。进行编码处理之后，L在浏览器中的显示结果就是这个文本，将变量作为纯文本进行输出，且不引起JavaScript的执行。



三、 CSRF 和 XSS 的区别
1、CSRF是跨站请求伪造;  XSS是跨域脚本攻击。
2、CSRF需要用户先登录网站A,获取cookie;  XSS不需要登录。
3、CSRF是利用网站A本身的漏洞,去请求网站A的api;  XSS是向网站A注入JS代码,然后执行JS里的代码,篡改网站A的内容。（XSS利用的是站点内的信任用户，而CSRF则是通过伪装来自受信任用户的请求来利用受信任的网站。你可以这么理解CSRF攻击：**攻击者盗用了你的身份，以你的名义向第三方网站发送恶意请求**。）